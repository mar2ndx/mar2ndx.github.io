<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    [Design] MapReduce Common Friends Example 丨
    

    typo
  </title>

  
  <link rel="shortcut icon" href="/icon.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">Tech blog</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">[Design] MapReduce Common Friends Example</div>
  <div class="post-meta">
    <div class="date">2014 August 5th</div>
    <div class="tags">
      
    </div>
  </div>
  

  <main class="post-content"><h3 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h3><p><a target="_blank" rel="noopener" href="http://stackoverflow.com/a/12375878">link</a></p>
<blockquote>
<p>Facebook’s “You and Joe have 230 friends in common” feature. Sure you could use a decent caching strategy, but for now, use MapReduce.</p>
</blockquote>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>This list doesn’t change frequently so it’d be wasteful to recalculate it every time. We’re going to use mapreduce to calculate everyone’s common friends once a day and store those results.</p>
<p>Note that friends are <strong>bi-directional</strong>. If I’m your friend, you’re mine. (follow-up: how to do it for follower system?)</p>
<h4 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h4><p>Assume the friends are stored as Person-&gt;[List of Friends], our friends list is then:</p>
<pre><code>A -&gt; B C D
B -&gt; A C D E
C -&gt; A B D E
D -&gt; A B C E
E -&gt; B C D
</code></pre>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><p>The mapper will output a key-value pair. The key will be a friend along with the person. The value will be the list of friends. The key will be sorted so that the friends are in order, causing all pairs of friends to go to the same reducer.</p>
<p>For map(A -&gt; B C D) :</p>
<pre><code>(A B) -&gt; B C D
(A C) -&gt; B C D
(A D) -&gt; B C D
</code></pre>
<p>For map(B -&gt; A C D E) : (Note that A comes before B in the key)</p>
<pre><code>(A B) -&gt; A C D E
(B C) -&gt; A C D E
(B D) -&gt; A C D E
(B E) -&gt; A C D E
</code></pre>
<p>For map(C -&gt; A B D E) :</p>
<pre><code>(A C) -&gt; A B D E
(B C) -&gt; A B D E
(C D) -&gt; A B D E
(C E) -&gt; A B D E
</code></pre>
<p>For map(D -&gt; A B C E) :</p>
<pre><code>(A D) -&gt; A B C E
(B D) -&gt; A B C E
(C D) -&gt; A B C E
(D E) -&gt; A B C E
</code></pre>
<p>And finally for map(E -&gt; B C D):</p>
<pre><code>(B E) -&gt; B C D
(C E) -&gt; B C D
(D E) -&gt; B C D
</code></pre>
<p>Before we send these key-value pairs to the reducers, we group them by their keys and get:</p>
<pre><code>(A B) -&gt; (A C D E) (B C D)
(A C) -&gt; (A B D E) (B C D)
(A D) -&gt; (A B C E) (B C D)
(B C) -&gt; (A B D E) (A C D E)
(B D) -&gt; (A B C E) (A C D E)
(B E) -&gt; (A C D E) (B C D)
(C D) -&gt; (A B C E) (A B D E)
(C E) -&gt; (A B D E) (B C D)
(D E) -&gt; (A B C E) (B C D)
</code></pre>
<p>Each line will be passed as an argument to a reducer.</p>
<h4 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h4><p>The reduce function will simply intersect the lists of values and output the same key with the result of the intersection. After reduction:</p>
<pre><code>(A B) -&gt; (C D)
(A C) -&gt; (B D)
(A D) -&gt; (B C)
(B C) -&gt; (A D E)
(B D) -&gt; (A C E)
(B E) -&gt; (C D)
(C D) -&gt; (A B E)
(C E) -&gt; (B D)
(D E) -&gt; (B C)
</code></pre>
<h4 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h4><p>Now when D visits B’s profile, we can quickly look up (B D) and see that they have three friends in common, (A C E).</p>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2024 typo</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>