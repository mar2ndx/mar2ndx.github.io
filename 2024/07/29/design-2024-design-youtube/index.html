<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    System Design 2024 - Youtube 丨
    

    typo
  </title>

  
  <link rel="shortcut icon" href="/icon.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">Tech blog</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">System Design 2024 - Youtube</div>
  <div class="post-meta">
    <div class="date">2024 July 29th</div>
    <div class="tags">
      
    </div>
  </div>
  

  <main class="post-content"><h1 id="Design-Youtube"><a href="#Design-Youtube" class="headerlink" title="Design Youtube"></a>Design Youtube</h1><p>We’ll follow the 5-step procedure:</p>
<ul>
<li><p>Scenario</p>
</li>
<li><p>Numbers</p>
</li>
<li><p>API and Database</p>
<ul>
<li>[Important] also include HLD schema!</li>
</ul>
</li>
<li><p>Performance</p>
<ul>
<li>Sharding and caching</li>
</ul>
</li>
<li><p>Evolve</p>
</li>
</ul>
<h1 id="1-Scenario"><a href="#1-Scenario" class="headerlink" title="1. Scenario"></a>1. Scenario</h1><h2 id="Functional-requirement"><a href="#Functional-requirement" class="headerlink" title="Functional requirement"></a>Functional requirement</h2><ol>
<li><strong>Upload video</strong></li>
<li><strong>Watch video</strong></li>
<li>Comment and like&#x2F;dislike</li>
<li>Search</li>
<li>Recommend</li>
<li>Detect bots</li>
<li>Ads</li>
</ol>
<h2 id="Non-Functional-requirement"><a href="#Non-Functional-requirement" class="headerlink" title="Non-Functional requirement"></a>Non-Functional requirement</h2><ol>
<li>High availability</li>
<li>Scale: support 1 billion users</li>
<li>Favor availability over consistency</li>
<li>Minimize latency</li>
</ol>
<h1 id="2-Numbers"><a href="#2-Numbers" class="headerlink" title="2. Numbers"></a>2. Numbers</h1><ol>
<li>500 uploads per second, from 1 billion registered users. </li>
<li></li>
</ol>
<h1 id="3-API-and-Database"><a href="#3-API-and-Database" class="headerlink" title="3. API and Database"></a>3. API and Database</h1><h2 id="HLD"><a href="#HLD" class="headerlink" title="HLD"></a>HLD</h2><ol>
<li>Need LB before the App server</li>
<li>Store raw file uploads to Object store, like AWS S3, Google Cloud Storage. </li>
<li>If you use MongoDB, it’s a collection of documents, document is a json. </li>
<li>The data is stored de-normalized (contains duplicate info). eg. Each video will also contains the uploader’s profile photo information. If user changes his profile photo, the update will be done asynchronously. </li>
<li>Vidoes should be loaded in smaller chunks. </li>
<li>The technology use for deliverying video is called Streaming.</li>
</ol>
<h2 id="API-design"><a href="#API-design" class="headerlink" title="API design"></a>API design</h2><ol>
<li>upload(title, desc, video, userId, etc…)</li>
<li>stream(videoId, startTime, etc…)</li>
</ol>
<h1 id="Application-server"><a href="#Application-server" class="headerlink" title="Application server"></a>Application server</h1><p><img src="/images/system-design-youtube-1.png"></p>
<h1 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h1><p>Skip for now.</p>
<h1 id="4-Performance"><a href="#4-Performance" class="headerlink" title="4. Performance"></a>4. Performance</h1><h2 id="How-many-encoding-server-do-I-need"><a href="#How-many-encoding-server-do-I-need" class="headerlink" title="How many encoding server do I need?"></a>How many encoding server do I need?</h2><p>If 500 uploads per second, we need much more than 500 encoding servers. </p>
<p>The requests are gonna be handled by the queue. It depends on how long the encoding, and how many thread on each worker. </p>
<p>Keep checking the backload status on the worker cluster. </p>
<p>eg. if each encoding cost 1 minutes, and each worker have 4 threads running encoding job. then you need 500 * 60 &#x2F; 4 &#x3D; 7,500 workers. </p>
<h2 id="TCP-or-UDP"><a href="#TCP-or-UDP" class="headerlink" title="TCP or UDP?"></a>TCP or UDP?</h2><p>Favor UDP over TCP, only if you are doing live-streaming. </p>
<p>But for youtube, it’s actually steaming a fixed video content. It actually send HTTP in smaller chunks, which is built on TCP technology. And it’s sending video and audio seperately. </p>
<h2 id="NoSQL-or-MySQL"><a href="#NoSQL-or-MySQL" class="headerlink" title="NoSQL or MySQL?"></a>NoSQL or MySQL?</h2><p>Youtube actually uses MySQL.</p>
<p>Later they added read-only NoSQL databse, and added sharding. </p>
<p>Later they built Vitess, which decouples application layer from DB layer, and scaled up MySQL for their usecase. Tody PlanetScale also uses Vitess. </p>
<h1 id="5-Evolve"><a href="#5-Evolve" class="headerlink" title="5. Evolve"></a>5. Evolve</h1></main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2024 typo</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>